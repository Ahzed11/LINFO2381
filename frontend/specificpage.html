<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Specific Patient View</title>
  <style> /* This style part of the code is in CSS. */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
    }

    /* Styles for the container for patient info, placed to the left, with boarder to group meta data*/
    #patient-container {
      position: absolute;
      top: 100px; /* Position it 80px down from the top */
      left: 20px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      max-width: 1000px;
      max-height: 2000px;
    }

    /* Styles for the patient picture, 50% radius makes it round */
    #patient-picture {
      width: 300px;
      height: 300px;
      border-radius: 50%;
    }

    /* Styles for the death wishes container */
    #deathwishes-container {
      position: relative; /* Position it relative to its normal position */
      text-align: left;
      margin: 200px auto;
      max-width: 600px;
      z-index: 2; /* Ensure it's above other elements */
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 44px;
    }

    /* Style for the button container */
  .button-container {
    display: flex;
    align-items: center;
  }
   /* Style for the back button */
   .back-button {
    display: inline-block;
    width: 100px;
    height: 30px;
    margin: 20px 0px 20px 20px; /* top right bottom left */
    padding: 10px;
    text-align: center;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    border: none;
    transition: background-color 0.3s ease;
  }

  .back-button:hover {
    background-color: #0056b3;
  }
  
  /* Style for the email button */
  .email-button {
    display: inline-block;
    width: 150px;
    height: 30px;
    margin: 20px 0px 20px 600px; /* top right bottom left */
    padding: 10px;
    text-align: center;
    background-color: #ff0000;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    border: none;
    transition: background-color 0.3s ease;
}

.email-button:hover {
  background-color: #cc0000;
}
  /* Style for the logo */
  #Logo {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 150px; 
    height: 150px; /* Adjust as needed */
    border: none;
  }

  </style>
</head>
<body>

  <div class="button-container">
    <!-- Button to go back to mainpage -->
    <a class="back-button" href="mainpage.html">Back to main page</a>
  
    <!-- Button to send alert email -->
    <a class="email-button" id="email-button">Send Alert Email</a>
  </div>
  
  <div id="patient-container">
    <div class="patient-details">
      <img id="patient-picture" src="https://voice.ons.org/sites/default/files/2018-12/1000_iStock-481073846.jpg" alt="Patient">
  
      <div id="patient-info">
        <h1 id="first_name">John</h1>
        <h1 id="last_name">Doe</h1>
        <h2 id="birthdate">Birthdate: 01/01/1970</h2>
        <h2 id="age">Age: 50</h2>
        <h2 id="diagnosis">Diagnosis: Cancer</h2>
        <h2 id="prognosis">Prognosis: Poor</h2>
        <h2 id="sex">Sex: Male</h2>
        <h2 id="patient_id">Patient id: xyz</h2>
      </div>
    </div>
  </div>

  <div id="deathwishes-container">
      <!-- Header for death wishes -->
      <h2>Death Wishes</h2>
      <!-- Unordered list of death wishes denoted ul, with list items called li -->
      <p id="deathwishes-list">
      </p>
  </div>
  
  <!-- Add logo to top -->
  <img id="Logo" src="..\images\Beyond_Wishes_Logo.png" alt="Logo"> 

  <script> 
    //This is instead of app.js 
    
    
    calculateAge(new Date(1990, 1, 1));


    document.addEventListener("DOMContentLoaded", () => { // DOMContentLoaded is the event that fires when the initial HTML document has been completely loaded and parsed, without waiting for stylesheets, images, and subframes to finish loading.
      console.log("Hello World!");

      // Get the patient ID from the URL
      const urlParams = new URLSearchParams(window.location.search);

      // Get the param : "patientId"
      const patientId = urlParams.get('patientId');

      // Fetch the patient data from the API

      fetch(`http://localhost:80/patients/${patientId}`)
        .then(response => response.json())
        .then(patient => {
          console.log(patient);

          // Calculate the age of the patient
          var age = calculateAge(new Date(patient.birthdate));

          // Set the patient info in the HTML
          document.getElementById('first_name').textContent = patient.first_name;
          document.getElementById('last_name').textContent = patient.last_name;
          document.getElementById('birthdate').textContent = `Birthdate: ${patient.birthdate}`;
          document.getElementById('diagnosis').textContent = `Diagnosis: ${patient.diagnosis}`;
          document.getElementById('prognosis').textContent = `Prognosis: ${patient.prognosis}`;
          document.getElementById('age').textContent = `Age: ${age}`; // Set the age in the HTML (id called age)
          document.getElementById('sex').textContent = `Sex: ${patient.sex}`;
          document.getElementById('patient_id').textContent = `Patient id: ${patient['_id']}`;

          // Modify the content of deathwishes with id deathwishes-list
          const deathwishesList = document.getElementById('deathwishes-list');
          deathwishesList.innerHTML = patient.wish;
    })
    });
    
    // Add an event listener to the email button 
    document.getElementById('email-button').addEventListener('click', () => {
      // Get the patient ID from the URL
        const patientId = new URLSearchParams(window.location.search).get('patientId');
        
        fetch(`http://localhost:80/patients/${patientId}/notify-relatives`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        }).then(function(response) {
          alert('Email sent to relative');
        }).catch(function(response) {
          alert('No relatives to notify');
        });
    });
    
  
    // Calculate the age for the specific page from the birthdate and the current date
    function calculateAge(birthdate) {
      const age = new Date().getFullYear() - birthdate.getFullYear();
      // Set the age in the HTML (id called age)
      return age;
    }</script>
</body>
</html>
